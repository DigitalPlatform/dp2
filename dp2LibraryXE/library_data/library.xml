<?xml version="1.0" encoding="utf-8"?>
<root>
    <version>2.01</version>
    <rmsserver url="net.pipe://localhost/dp2kernel/XE" username="root" password="sKPNlfoEw1s=" />
    <arrived dbname="" reserveTimeSpan="2day" canReserveOnshelf="true" />
    <message dbname="" />
    <amerce dbname="" />
    <readerdbgroup>
    </readerdbgroup>
    <itemdbgroup>
    </itemdbgroup>
    <rightsTable>
        <type reader="本科生">
            <param name="可借总册数" value="10" />
            <param name="可预约册数" value="5" />
            <param name="以停代金因子" value="1.0" />
            <param name="工作日历名" value="基本日历" />
            <type book="普通">
                <param name="可借册数" value="10" />
                <param name="借期" value="31day,15day" />
                <param name="超期违约金因子" value="CNY1.0/day" />
                <param name="丢失违约金因子" value="1.5" />
            </type>
            <type book="教材">
                <param name="可借册数" value="10" />
                <param name="借期" value="31day,15day" />
                <param name="超期违约金因子" value="CNY1.0/day" />
                <param name="丢失违约金因子" value="1.5" />
            </type>
            <type book="教学参考">
                <param name="可借册数" value="10" />
                <param name="借期" value="31day,15day" />
                <param name="超期违约金因子" value="CNY1.0/day" />
                <param name="丢失违约金因子" value="1.5" />
            </type>
            <type book="原版西文">
                <param name="可借册数" value="2" />
                <param name="借期" value="31day,15day" />
                <param name="超期违约金因子" value="CNY1.0/day" />
                <param name="丢失违约金因子" value="3.0" />
            </type>
        </type>
        <type reader="硕士生">
            <param name="可借总册数" value="15" />
            <param name="可预约册数" value="5" />
            <param name="以停代金因子" value="1.0" />
            <param name="工作日历名" value="基本日历" />
            <type book="普通">
                <param name="可借册数" value="10" />
                <param name="借期" value="31day,15day" />
                <param name="超期违约金因子" value="CNY1.0/day" />
                <param name="丢失违约金因子" value="1.5" />
            </type>
            <type book="教材">
                <param name="可借册数" value="10" />
                <param name="借期" value="31day,15day" />
                <param name="超期违约金因子" value="CNY1.0/day" />
                <param name="丢失违约金因子" value="1.5" />
            </type>
            <type book="教学参考">
                <param name="可借册数" value="10" />
                <param name="借期" value="31day,15day" />
                <param name="超期违约金因子" value="CNY1.0/day" />
                <param name="丢失违约金因子" value="1.5" />
            </type>
            <type book="原版西文">
                <param name="可借册数" value="3" />
                <param name="借期" value="31day,15day" />
                <param name="超期违约金因子" value="CNY1.0/day" />
                <param name="丢失违约金因子" value="3.0" />
            </type>
        </type>
        <type reader="博士生">
            <param name="可借总册数" value="20" />
            <param name="可预约册数" value="5" />
            <param name="以停代金因子" value="1.0" />
            <param name="工作日历名" value="基本日历" />
            <type book="普通">
                <param name="可借册数" value="10" />
                <param name="借期" value="31day,15day" />
                <param name="超期违约金因子" value="CNY1.0/day" />
                <param name="丢失违约金因子" value="1.5" />
            </type>
            <type book="教材">
                <param name="可借册数" value="10" />
                <param name="借期" value="31day,15day" />
                <param name="超期违约金因子" value="CNY1.0/day" />
                <param name="丢失违约金因子" value="1.5" />
            </type>
            <type book="教学参考">
                <param name="可借册数" value="10" />
                <param name="借期" value="31day,15day" />
                <param name="超期违约金因子" value="CNY1.0/day" />
                <param name="丢失违约金因子" value="1.5" />
            </type>
            <type book="原版西文">
                <param name="可借册数" value="4" />
                <param name="借期" value="31day,15day" />
                <param name="超期违约金因子" value="CNY1.0/day" />
                <param name="丢失违约金因子" value="3.0" />
            </type>
        </type>
        <type reader="讲师">
            <param name="可借总册数" value="20" />
            <param name="可预约册数" value="5" />
            <param name="以停代金因子" value="1.0" />
            <param name="工作日历名" value="基本日历" />
            <type book="普通">
                <param name="可借册数" value="10" />
                <param name="借期" value="31day,15day" />
                <param name="超期违约金因子" value="CNY1.0/day" />
                <param name="丢失违约金因子" value="1.5" />
            </type>
            <type book="教材">
                <param name="可借册数" value="10" />
                <param name="借期" value="31day,15day" />
                <param name="超期违约金因子" value="CNY1.0/day" />
                <param name="丢失违约金因子" value="1.5" />
            </type>
            <type book="教学参考">
                <param name="可借册数" value="10" />
                <param name="借期" value="31day,15day" />
                <param name="超期违约金因子" value="CNY1.0/day" />
                <param name="丢失违约金因子" value="1.5" />
            </type>
            <type book="原版西文">
                <param name="可借册数" value="5" />
                <param name="借期" value="31day,15day" />
                <param name="超期违约金因子" value="CNY1.0/day" />
                <param name="丢失违约金因子" value="3.0" />
            </type>
        </type>
        <type reader="教授">
            <param name="可借总册数" value="30" />
            <param name="可预约册数" value="5" />
            <param name="以停代金因子" value="1.0" />
            <param name="工作日历名" value="基本日历" />
            <type book="普通">
                <param name="可借册数" value="10" />
                <param name="借期" value="31day,15day" />
                <param name="超期违约金因子" value="CNY1.0/day" />
                <param name="丢失违约金因子" value="1.5" />
            </type>
            <type book="教材">
                <param name="可借册数" value="10" />
                <param name="借期" value="31day,15day" />
                <param name="超期违约金因子" value="CNY1.0/day" />
                <param name="丢失违约金因子" value="1.5" />
            </type>
            <type book="教学参考">
                <param name="可借册数" value="10" />
                <param name="借期" value="31day,15day" />
                <param name="超期违约金因子" value="CNY1.0/day" />
                <param name="丢失违约金因子" value="1.5" />
            </type>
            <type book="原版西文">
                <param name="可借册数" value="6" />
                <param name="借期" value="31day,15day" />
                <param name="超期违约金因子" value="CNY1.0/day" />
                <param name="丢失违约金因子" value="3.0" />
            </type>
        </type>
        <readerTypes>
            <item>本科生</item>
            <item>硕士生</item>
            <item>博士生</item>
            <item>讲师</item>
            <item>教授</item>
        </readerTypes>
        <bookTypes>
            <item>普通</item>
            <item>教材</item>
            <item>教学参考</item>
            <item>原版西文</item>
        </bookTypes>
    </rightsTable>
    <locationTypes>
        <item canborrow="no">保存本库</item>
        <item canborrow="no">阅览室</item>
        <item canborrow="yes">流通库</item>
    </locationTypes>

    <accounts>
        <account name="supervisor"  rights="borrow,return,renew,lost,reservation,order,setclock,changereaderpassword,verifyreaderpassword,getbibliosummary,searchreader,getreaderinfo,setreaderinfo,movereaderinfo,changereaderstate,listbibliodbfroms,listdbfroms,searchbiblio,getbiblioinfo,searchitem,getiteminfo,setiteminfo,getoperlog,amerce,amercemodifyprice,amercemodifycomment,amerceundo,search,getrecord,getcalendar,changecalendar,newcalendar,deletecalendar,batchtask,clearalldbs,devolvereaderinfo,getuser,changeuser,newuser,deleteuser,changeuserpassword,getsystemparameter,setsystemparameter,urgentrecover,repairborrowinfo,passgate,getres,writeres,setbiblioinfo,hire,foregift,returnforegift,settlement,undosettlement,deletesettlement,searchissue,getissueinfo,setissueinfo,searchorder,getorderinfo,setorderinfo,getcommentinfo,setcommentinfo,searchcomment,writeobject,writerecord,writetemplate,managedatabase,restore,managecache,managecomment,settailnumber,setutilinfo,getpatrontempid,getchannelinfo,managechannel,viewreport,upload,download" type="" />
        <account name="reader" type="reader" rights="getreaderinfo,getbibliosummary,renew,reservation,search,getbiblioinfo,getiteminfo,getcommentinfo,setcommentinfo,setreaderinfo,changereaderpassword,getsystemparameter,listdbfroms,getres" />
        <account name="public" type="reader" rights="denychangemypassword,search,getbiblioinfo,getbibliosummary,getiteminfo,getorderinfo,getissueinfo,getcommentinfo,getres" />
        <account name="图书馆" rights="" type="" />
        <account name="opac" rights="denychangemypassword,getsystemparameter,getres,search,getbiblioinfo,setbiblioinfo,getreaderinfo,writeobject,getbibliosummary,listdbfroms,simulatereader,simulateworker,getiteminfo,getorderinfo,getissueinfo,getcommentinfo" />
    </accounts>
    <browseformats>

    </browseformats>

    <virtualDatabases searchMaxResultCount='5000'>
    </virtualDatabases>
    <valueTables>

    </valueTables>
    <calendars>
        <calendar name="基本日历" range="20080101-20091231" comment="图书馆开馆日历">20080101,20090101</calendar>
    </calendars>
    <script>
        <![CDATA[
using System;
using System.Xml;

using DigitalPlatform.Xml;
using DigitalPlatform.IO;
using DigitalPlatform.Text;

using DigitalPlatform.LibraryServer;


public class MyLibraryHost : LibraryHost
{

	// 获得书目数据局部
	public int GetBiblioPart(XmlDocument bibliodom,
		string strPartName,
		out string strResultValue)
	{
		strResultValue = "";

		XmlNamespaceManager mngr = new XmlNamespaceManager(new NameTable());
		mngr.AddNamespace("dprms", DpNs.dprms);

		XmlNode node = null;


		if (bibliodom.DocumentElement.NamespaceURI == Ns.usmarcxml)
		{

			mngr.AddNamespace("usmarc", Ns.usmarcxml);	// "http://www.loc.gov/MARC21/slim"

			string strXPath = "";

			if (strPartName == "price")
				strXPath = "//usmarc:record/usmarc:datafield[@tag='020']/usmarc:subfield[@code='c']";
			else if (strPartName == "accessno")
			{
				strXPath = "//usmarc:record/usmarc:datafield[@tag='905']/usmarc:subfield[@code='d']";

				string d = "";

				node = bibliodom.SelectSingleNode(strXPath, mngr);
				if (node != null)
					d = node.InnerText;


				strXPath = "//usmarc:record/usmarc:datafield[@tag='905']/usmarc:subfield[@code='e']";

				string e = "";

				node = bibliodom.SelectSingleNode(strXPath, mngr);
				if (node != null)
					e = node.InnerText;

				strResultValue = d + "/" + e;
				return 1;
			}
      else if (strPartName == "class")
			{
        			// USMARC里面的中图法类号
				strXPath = "//usmarc:record/usmarc:datafield[@tag='093']/usmarc:subfield[@code='a']";

				node = bibliodom.SelectSingleNode(strXPath, mngr);
				if (node != null)
				{
					strResultValue  = node.InnerText;
					return 1;
				}
				else
					return 0;
			}
      else if (strPartName == "isbnissn")
			{
				strXPath = "//usmarc:record/usmarc:datafield[@tag='020']/usmarc:subfield[@code='a'] | //usmarc:record/usmarc:datafield[@tag='020']/usmarc:subfield[@code='z'] | //usmarc:record/usmarc:datafield[@tag='022']/usmarc:subfield[@code='a'] | //usmarc:record/usmarc:datafield[@tag='022']/usmarc:subfield[@code='z']";

				node = bibliodom.SelectSingleNode(strXPath, mngr);
				if (node != null)
				{
					strResultValue  = node.InnerText;
					return 1;
				}
				else
					return 0;
			}
			else if (strPartName == "title")
			{
				strXPath = "//usmarc:record/usmarc:datafield[@tag='245']/usmarc:subfield[@code='a']";

				node = bibliodom.SelectSingleNode(strXPath, mngr);
				if (node != null)
				{
					strResultValue  = node.InnerText;
					return 1;
				}
				else
					return 0;
			}
			else
			{
				strResultValue = "不能识别的 strPartName 值 '" + strPartName + "'";
				return -1;
			}

			node = bibliodom.SelectSingleNode(strXPath, mngr);
			if (node == null)
				return 0;

			strResultValue = node.InnerText;
			return 1;
		}
		else if (bibliodom.DocumentElement.NamespaceURI == DpNs.unimarcxml)
		{
			mngr.AddNamespace("unimarc", DpNs.unimarcxml);	// "http://dp2003.com/UNIMARC"

			string strXPath = "";

			if (strPartName == "price")
			{
				strXPath = "//unimarc:record/unimarc:datafield[@tag='010']/unimarc:subfield[@code='d']";
				// 092?

				node = bibliodom.SelectSingleNode(strXPath, mngr);
				if (node == null)
				{
					strXPath = "//unimarc:record/unimarc:datafield[@tag='091']/unimarc:subfield[@code='d']";

					node = bibliodom.SelectSingleNode(strXPath, mngr);
					if (node == null)
						return 0;
				}

				strResultValue = node.InnerText;
				return 1;
			}
			else if (strPartName == "accessno")
			{
				strXPath = "//unimarc:record/unimarc:datafield[@tag='905']/unimarc:subfield[@code='d']";

				string d = "";

				node = bibliodom.SelectSingleNode(strXPath, mngr);
				if (node != null)
					d = node.InnerText;


				strXPath = "//unimarc:record/unimarc:datafield[@tag='905']/unimarc:subfield[@code='e']";

				string e = "";

				node = bibliodom.SelectSingleNode(strXPath, mngr);
				if (node != null)
					e = node.InnerText;

				strResultValue = d + "/" + e;
				return 1;
			}
      else if (strPartName == "class")
			{
				strXPath = "//unimarc:record/unimarc:datafield[@tag='690']/unimarc:subfield[@code='a']";

				node = bibliodom.SelectSingleNode(strXPath, mngr);
				if (node != null)
				{
					strResultValue  = node.InnerText;
					return 1;
				}
				else
					return 0;
			}
			else if (strPartName == "isbnissn")
			{
				strXPath = "//unimarc:record/unimarc:datafield[@tag='010']/unimarc:subfield[@code='a'] | //unimarc:record/unimarc:datafield[@tag='010']/unimarc:subfield[@code='z'] | //unimarc:record/unimarc:datafield[@tag='011']/unimarc:subfield[@code='a'] | //unimarc:record/unimarc:datafield[@tag='011']/unimarc:subfield[@code='z']";

				node = bibliodom.SelectSingleNode(strXPath, mngr);
				if (node != null)
				{
					strResultValue  = node.InnerText;
					return 1;
				}
				else
					return 0;
			}
			else if (strPartName == "title")
			{
				strXPath = "//unimarc:record/unimarc:datafield[@tag='200']/unimarc:subfield[@code='a']";

				node = bibliodom.SelectSingleNode(strXPath, mngr);
				if (node != null)
				{
					strResultValue  = node.InnerText;
					return 1;
				}
				else
					return 0;
			}
			else
			{
				strResultValue = "不能识别的 strPartName 值 '" + strPartName + "'";
				return -1;
			}

			node = bibliodom.SelectSingleNode(strXPath, mngr);
			if (node == null)
				return 0;



			strResultValue = node.InnerText;
			return 1;
		}
		else {
			strResultValue = "无法识别的MARC格式";
			return -1;
		}

	}
}

]]><refs><ref>system.dll</ref><ref>system.xml.dll</ref><ref>%bindir%/digitalplatform.xml.dll</ref><ref>%bindir%/digitalplatform.io.dll</ref><ref>%bindir%/digitalplatform.text.dll</ref></refs></script>

    <mailTemplates>
        <template name="预约到书通知">
尊敬的读者：
您预约的图书%item%已经到书，请尽快来图书馆办理借书手续。图书馆将为您保留%reservetime%，如果您未能在保留期限内来馆办理借阅手续，图书馆将把优先借阅权转给后面排队等待的预约者，或做归架处理。

%today%
	</template>
        <template name="预约到书通知(在架)">
尊敬的读者：
您预约的图书%item%已经在架上，请尽快来图书馆办理借书手续。图书馆将为您保留%reservetime%，如果您未能在保留期限内来馆办理借阅手续，图书馆将把优先借阅权转给后面排队等待的预约者，或允许其他读者借阅。

%today%
	</template>
    </mailTemplates>
    <zhongcihao>
        <nstable name="nstable">
            <item prefix="unimarc" uri="http://dp2003.com/UNIMARC" />
            <item prefix="usmarc" uri="http://www.loc.gov/MARC21/slim" />
        </nstable>
    </zhongcihao>
    <callNumber>
        <group name="中图法" classType="中图法" qufenhaoType="Cutter-Sanborn Three-Figure,GCAT" zhongcihaodb="" callNumberStyle="索取类号+区分号">
            <location name="保存本库" />
            <location name="阅览室" />
            <location name="流通库" />
        </group>
    </callNumber>
    <monitors>
        <readersMonitor startTime="23:00" />
        <arriveMonitor startTime="23:00" />
        <messageMonitor startTime="23:00" />
    </monitors>
    <utilDb>
    </utilDb>
    <circulation patronAdditionalFroms="证号,姓名" verifyBookType="true" verifyReaderType="true" />
    <clock>0</clock>
</root>